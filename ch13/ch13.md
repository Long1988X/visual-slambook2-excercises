[toc]

# 第13讲 实践：设计SLAM系统

## 1. 目标

1. 实际设计一个视觉里程计。
2. 理解SLAM软件框架是如何搭建的。
3. 理解在视觉里程计设计中容易出现的问题，以及修补的方法。

## 2. 知识点

1. 工程实践和理解算法原理是同等重要的。
2. 建造建筑需要大量的尝试、时间和经验。
3. 一个实用的程序会有很多的工程设计和技巧，还需要讨论每一步出现问题之后该如何处理。
4. 基本数据结构实现：帧、特征、路标点；
5. 最基础的数据结构用struct定义；
6. 线程锁；
7. share_ptr<> / weak_ptr<>
8. unique_lock<std::mutex>
9. 数据结构unordered_map<>
10. 实现时，尽量利用逻辑上的分拆，把复杂功能拆成一些短小的函数。

## 3. 实践

1. SLAM系统设计：
   1. 工程框架，小型算法库普遍做法；
   2. 基础数据结构
   3. 核心算法
   4. 模块逻辑
   
2. 精简版的双目视觉里程计：

   > 1. 使用Kitti数据集；
   > 2. 由一个光流追踪的前端和一个局部BA的后端组成。

## 4. 课后习题

1. 本书使用的C++技巧逆都看懂了吗？如果有不明白的地方，使用搜索引擎补充相关知识，包括基于范围的for循环、智能指针、设计模式中的单例模式等等。

   [参考：智能指针](https://www.cnblogs.com/greatverve/p/smart-ptr.html)

   > 1. 需要使用一个共享对象的时候，shared_ptr 是再好不过的了。
   >
   > 2. weak_ptr 是专门为shared_ptr 而准备的。
   >
   >    有时候，我们只关心能否使用对象，并不关心内部的引用计数。
   >
   >    weak_ptr 是 shared_ptr 的观察者（Observer）对象，观察者意味着weak_ptr 只对shared_ptr 进行引用，而不改变其引用计数，
   >
   >    当被观察的 shared_ptr 失效后，相应的weak_ptr 也相应失效。
   >
   > 3. unique_ptr对象始终是关联的原始指针的唯一所有者。我们无法复制unique_ptr对象，它只能移动。
   >     由于每个unique_ptr对象都是原始指针的唯一所有者，因此在其析构函数中它直接删除关联的指针，不需要任何参考计数。
   >
   >    我们无法复制 unique_ptr 对象，但我们可以转移它们。这意味着 unique_ptr 对象可以将关联的原始指针的所有权转移到另一个 unique_ptr 对象
   >
   > 4. 编译时会警告：`warning: 'template<class> class std::auto_ptr' is deprecated [-Wdeprecated-declarations]`。说明 auto_ptr 已经过时了

2. 考虑对本讲的系统进行优化。

   例如，使用更快的提特征点方式（本节使用了GFTT，它并不算快），

   在左右匹配时使用一维的搜索而非二维的光流，

   使用直接法同时估计位姿与特征点对应关系，等等。

3. 为本节代码添加回环检测模块，在检测到回环时使用位姿图进行优化以消除累积误差。
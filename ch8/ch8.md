[toc]

# 第8讲 视觉里程计2

## 1. 目标

1. 理解光流法跟踪特征点的原理。
2. 理解直接法是如何估计相机位姿的。
3. 实现多层直接法的计算。

## 2. 知识点

1. 直接法的引出：
   1. 特征点法的缺点；
   2. 克服以上缺点的思路：
      * 光流法跟踪特征点运动；
      * 直接法计算特征点在下一刻图像的位置，同时估计相机运动和点的投影；
2. 特征点法与直接法优化：
   1. 特征点法：最小化**重投影误差(Reprojection error)**；
   2. 直接法：最小化**光度误差(Photometric error)**。
3. 2D光流：通过最小化灰度误差估计最优的像素偏移。
4. 直接法：根据当前相机的位姿估计寻找哦$p_2$的位置。==优化变量是相机位姿$T$==。

## 3. 实践

1. 手写高斯牛顿法多层光流
   1. 读取$I_1、I_2$两时刻图像；
   2. 提取$I_1$图像中的关键点，可以尝试ORB、GFTT、FAST等算法；
   3. 使用高斯牛顿法迭代，计算$I_1$中提取的关键点，其在$I_2$图像中的位置；
   4. 计算灰度误差及雅可比矩阵，从而计算出H和b，求解更新量update；
2. 多层直接法；
3. ==Ceres实现稀疏直接法和半稠密直接法==
4. ==g2o实现稀疏直接法和半稠密直接法==

## 4. 课后习题

1. 除了LK光流，还有哪些光流方法？它们各有什么特点？

   光流法就是一种你根据视觉成像信息来感知自己的运动状态的一种方法。目前，按照理论基础与数学方法的区别把它们分成：基于梯度的方法、基于匹配的方法、基于能量的方法、基于相位的方法以及神经动力学方法。具体各种算法有一篇博客说的比较细节，大家可以参考：https://blog.csdn.net/qq_38906523/article/details/80781242，有兴趣可以去读一些关于光流算法的综述，比如《A Database and Evaluation Methodology for Optical Flow》。

2. 在本节程序的求图像梯度过程中，我们简单地求了$u+1$和$u-1$的灰度之差除以2，作为$u$方向上的梯度值。

   这种做法有什么缺点？提示：对于距离较近的特征，变化应该较快；而距离较远的特征在图像中变化较慢，求梯度时能否利用此信息？

   当被观测的特征点离相机距离比较小时，其像素的运动会明显加快，像素跨度会增大，像素的梯度不可能能被左右两个像素灰度值之和除以2的，而且这种方法也很容易被噪音影响以至于光流运算过程精度下降。当距离特别远时，容易速度变化过小，引起漂移。在求梯度时，对于不同深度的像素块可以分层优化求解。在式(8.16)中，像素梯度为０，整项雅可比矩阵就为零，不会对计算运动增量有任何贡献。

3. 直接法是否能和光流一样，提出“反向法”的概念？即：使用原始图像的梯度代替目标图像的梯度？

   // TODO

4. 使用Ceres或g2o实现稀疏直接法和半稠密直接法。

   // TODO

5. 相比于RGB-D的直接法，单目直接法往往更加复杂。

   除了匹配未知，像素的距离也是待估计的，我们需要在优化时把像素深度也作为优化变量。

   阅读参考文献[69，75]，你能理解它的原理吗？

   ![img](https://img-blog.csdnimg.cn/20190110163130768.jpg?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzE3MDMyODA3,size_16,color_FFFFFF,t_70)